# Notion Invoice Manager MVP PRD

## 🎯 핵심 정보

**목적**: Notion을 CMS로 활용하여 인보이스를 생성/관리하고, 클라이언트가 웹에서 조회하고 PDF로 다운로드할 수 있는 시스템
**사용자**: 프리랜서, 소규모 사업자 (인보이스 발행자) 및 그들의 클라이언트 (인보이스 수령자)

---

## 🚶 사용자 여정

### A. 인보이스 발행자 (Invoice Creator) 플로우

```
1. Notion 데이터베이스 설정
   ↓ [Notion에서 인보이스 템플릿 데이터베이스 생성]

2. 웹 앱 설정 페이지
   ↓ [Notion API 키 및 데이터베이스 ID 연동]

3. Notion에서 인보이스 작성
   ↓ [Notion 데이터베이스에 새 인보이스 항목 생성]

4. 웹 앱 대시보드 페이지
   ↓ [동기화된 인보이스 목록 확인]

5. 인보이스 상세 페이지
   ↓ [미리보기 확인 및 공유 링크 생성]

6. 클라이언트에게 공유 링크 전송
   ↓ [이메일 또는 메신저로 링크 공유]
```

### B. 인보이스 수령자 (Client) 플로우

```
1. 공유 링크 수신
   ↓ [발행자로부터 받은 URL 클릭]

2. 인보이스 조회 페이지
   ↓ [인보이스 상세 내용 확인]

   [조건: 인증 필요 여부]
   - 공개 링크 → 즉시 조회
   - 비공개 링크 → 액세스 코드 입력 → 조회

3. 인보이스 확인
   ↓ [내용 검토]

4. PDF 다운로드
   ↓ [다운로드 버튼 클릭]

5. PDF 저장 완료
```

---

## ⚡ 기능 명세

### 1. MVP 핵심 기능

| ID | 기능명 | 설명 | MVP 필수 이유 | 관련 페이지 |
|----|--------|------|-------------|------------|
| **F001** | Notion 데이터베이스 연동 | Notion API를 통해 인보이스 데이터베이스 읽기 | 핵심 CMS 기능 제공 | 설정 페이지, 대시보드 페이지 |
| **F002** | 인보이스 목록 조회 | 연동된 Notion DB의 모든 인보이스 표시 | 관리자의 인보이스 관리 필수 | 대시보드 페이지 |
| **F003** | 인보이스 상세 보기 | 개별 인보이스의 모든 정보 표시 (청구서 번호, 날짜, 항목, 금액 등) | 클라이언트 조회 핵심 기능 | 인보이스 상세 페이지, 공개 인보이스 페이지 |
| **F004** | PDF 생성 및 다운로드 | 인보이스를 PDF 형식으로 변환하여 다운로드 | 클라이언트의 핵심 니즈 (저장/인쇄) | 인보이스 상세 페이지, 공개 인보이스 페이지 |
| **F005** | 공유 링크 생성 | 특정 인보이스의 고유 공개 URL 생성 | 클라이언트에게 전달하는 핵심 방법 | 인보이스 상세 페이지 |

### 2. MVP 필수 지원 기능

| ID | 기능명 | 설명 | MVP 필수 이유 | 관련 페이지 |
|----|--------|------|-------------|------------|
| **F010** | 기본 인증 | 관리자용 로그인 (Notion API 키 보호) | 관리 기능 접근 제어 | 로그인 페이지 |
| **F011** | Notion API 설정 관리 | Notion API 키 및 데이터베이스 ID 저장 | Notion 연동을 위한 필수 설정 | 설정 페이지 |
| **F012** | 인보이스 동기화 | Notion DB 변경사항 실시간/수동 동기화 | 최신 데이터 유지 필수 | 대시보드 페이지, 설정 페이지 |
| **F013** | 인보이스 상태 관리 | 발행됨/지불 대기/지불 완료 상태 표시 | 인보이스 관리 효율성 | 대시보드 페이지, 인보이스 상세 페이지 |

### 3. MVP 이후 기능 (제외)

- 다국어 지원 (i18n)
- 이메일 자동 발송 기능
- 인보이스 템플릿 커스터마이징 (색상, 로고 등)
- 결제 게이트웨이 연동 (Stripe, PayPal)
- 클라이언트 관리 시스템 (CRM)
- 인보이스 통계 및 리포트
- 리마인더 및 알림 기능
- 다중 통화 지원

---

## 📱 메뉴 구조

```
📱 Notion Invoice Manager 내비게이션

🏠 홈
└── 기능: 서비스 소개 및 시작 가이드

👤 인증 (비로그인 시)
├── 로그인 - F010
└── 회원가입 - F010

📊 관리자 메뉴 (로그인 후)
├── 📋 대시보드
│   └── 기능: F002, F012, F013 (인보이스 목록, 동기화, 상태 관리)
├── 📄 인보이스 상세
│   └── 기능: F003, F004, F005 (상세 보기, PDF 다운로드, 공유 링크 생성)
├── ⚙️ 설정
│   └── 기능: F011, F012 (Notion API 설정, 수동 동기화)
└── 🚪 로그아웃

🌐 공개 메뉴 (인증 불필요)
└── 📄 인보이스 조회
    └── 기능: F003, F004 (공개 인보이스 조회, PDF 다운로드)
```

---

## 📄 페이지별 상세 기능

### 홈 페이지

> **구현 기능:** 없음 (마케팅 페이지) | **메뉴 위치:** 헤더 메인 메뉴

| 항목 | 내용 |
|------|------|
| **역할** | 서비스 랜딩 페이지, 가치 제안 및 사용 방법 소개 |
| **진입 경로** | 직접 접속 (루트 URL) |
| **사용자 행동** | 서비스 설명 읽기, 시작하기 버튼 클릭 |
| **주요 기능** | • 서비스 소개 섹션<br>• 주요 기능 설명 (Notion 연동, PDF 생성 등)<br>• 사용 방법 3단계 가이드<br>• **시작하기** 버튼 → 로그인 페이지 이동 |
| **다음 이동** | 시작하기 → 로그인 페이지 |

---

### 로그인 페이지

> **구현 기능:** `F010` | **인증:** 불필요 (로그인 전 페이지)

| 항목 | 내용 |
|------|------|
| **역할** | 관리자 인증 페이지 |
| **진입 경로** | 홈에서 시작하기 클릭, 또는 보호된 페이지 접근 시 자동 리디렉션 |
| **사용자 행동** | 이메일/비밀번호 입력 후 로그인 |
| **주요 기능** | • 이메일 입력 필드 (Zod 검증)<br>• 비밀번호 입력 필드<br>• 로그인 상태 유지 체크박스<br>• **로그인** 버튼<br>• "계정이 없으신가요?" → 회원가입 링크 |
| **다음 이동** | 성공 → 대시보드 페이지, 실패 → 에러 메시지 표시 |

---

### 대시보드 페이지

> **구현 기능:** `F002`, `F012`, `F013` | **인증:** 필수 (관리자만)

| 항목 | 내용 |
|------|------|
| **역할** | 관리자의 메인 인보이스 관리 화면 |
| **진입 경로** | 로그인 성공 후 자동 이동, 헤더 메뉴의 대시보드 클릭 |
| **사용자 행동** | 인보이스 목록 확인, 특정 인보이스 클릭하여 상세 보기, 동기화 버튼으로 Notion 데이터 갱신 |
| **주요 기능** | • Notion DB에서 가져온 인보이스 목록 테이블<br>• 각 행: 인보이스 번호, 클라이언트명, 발행일, 금액, 상태 (발행됨/지불 대기/완료)<br>• 상태별 필터링 (전체/지불 대기/완료)<br>• **동기화** 버튼 (Notion 데이터 최신화)<br>• 검색 기능 (인보이스 번호 또는 클라이언트명)<br>• 테이블 행 클릭 → 인보이스 상세 페이지 이동 |
| **다음 이동** | 인보이스 클릭 → 인보이스 상세 페이지 |

---

### 인보이스 상세 페이지

> **구현 기능:** `F003`, `F004`, `F005` | **인증:** 필수 (관리자만)

| 항목 | 내용 |
|------|------|
| **역할** | 관리자가 인보이스 전체 내용 확인 및 공유/PDF 생성 |
| **진입 경로** | 대시보드에서 특정 인보이스 클릭 |
| **사용자 행동** | 인보이스 내용 검토, PDF 다운로드, 공유 링크 복사 |
| **주요 기능** | • 인보이스 전체 정보 표시<br>  - 발행자 정보 (이름, 주소, 연락처)<br>  - 클라이언트 정보 (이름, 주소, 연락처)<br>  - 인보이스 번호 및 발행일<br>  - 청구 항목 리스트 (품목, 수량, 단가, 금액)<br>  - 소계, 세금, 총액<br>  - 결제 조건 및 메모<br>• **PDF 다운로드** 버튼 → PDF 생성 및 다운로드<br>• **공유 링크 생성** 버튼 → 클립보드 복사<br>• 공유 링크 표시 영역 (생성 후)<br>• **목록으로** 버튼 → 대시보드 복귀 |
| **다음 이동** | 목록으로 → 대시보드 페이지 |

---

### 설정 페이지

> **구현 기능:** `F011`, `F012` | **인증:** 필수 (관리자만)

| 항목 | 내용 |
|------|------|
| **역할** | Notion API 연동 설정 및 데이터베이스 관리 |
| **진입 경로** | 헤더 메뉴의 설정 클릭 |
| **사용자 행동** | Notion API 키 및 데이터베이스 ID 입력/수정, 연동 테스트, 수동 동기화 실행 |
| **주요 기능** | • **Notion API 키** 입력 필드 (비밀번호 타입, 검증)<br>• **Notion 데이터베이스 ID** 입력 필드 (검증)<br>• **연동 테스트** 버튼 → API 연결 확인 및 결과 표시<br>• **저장** 버튼 → 설정 저장<br>• **수동 동기화** 버튼 → Notion DB 최신 데이터 가져오기<br>• 마지막 동기화 시간 표시<br>• Notion 데이터베이스 설정 가이드 링크 |
| **다음 이동** | 저장 성공 → 대시보드 페이지 권장 |

---

### 공개 인보이스 페이지

> **구현 기능:** `F003`, `F004` | **인증:** 불필요 (공개 URL)

| 항목 | 내용 |
|------|------|
| **역할** | 클라이언트가 공유 링크로 인보이스 조회 및 다운로드 |
| **진입 경로** | 발행자로부터 받은 공유 URL 직접 접속 (예: `/invoice/[invoice-id]`) |
| **사용자 행동** | 인보이스 내용 확인, PDF 다운로드 |
| **주요 기능** | • 인보이스 전체 정보 표시 (관리자 상세 페이지와 동일한 레이아웃)<br>  - 발행자 정보<br>  - 클라이언트 정보<br>  - 인보이스 번호, 발행일<br>  - 청구 항목 리스트<br>  - 총액 계산<br>• **PDF 다운로드** 버튼<br>• 깨끗하고 프린트 친화적인 디자인<br>• 관리 기능 없음 (읽기 전용) |
| **다음 이동** | 없음 (독립 페이지, 브라우저 닫기) |

---

## 🗄️ 데이터 모델

### User (관리자 계정)
| 필드 | 설명 | 타입/관계 |
|------|------|----------|
| id | 고유 식별자 | UUID |
| email | 로그인 이메일 | String (unique) |
| password_hash | 암호화된 비밀번호 | String |
| created_at | 계정 생성 시각 | Timestamp |

### NotionConfig (Notion 연동 설정)
| 필드 | 설명 | 타입/관계 |
|------|------|----------|
| id | 고유 식별자 | UUID |
| user_id | 소유자 | → User.id |
| api_key | Notion API 키 (암호화 저장) | String (encrypted) |
| database_id | Notion 데이터베이스 ID | String |
| last_synced_at | 마지막 동기화 시각 | Timestamp |

### Invoice (인보이스 데이터)
| 필드 | 설명 | 타입/관계 |
|------|------|----------|
| id | 고유 식별자 | UUID |
| notion_page_id | Notion 페이지 ID | String (unique) |
| invoice_number | 인보이스 번호 | String |
| issue_date | 발행일 | Date |
| client_name | 클라이언트 이름 | String |
| client_email | 클라이언트 이메일 | String |
| client_address | 클라이언트 주소 | Text |
| issuer_name | 발행자 이름 | String |
| issuer_email | 발행자 이메일 | String |
| issuer_address | 발행자 주소 | Text |
| total_amount | 총액 | Decimal |
| currency | 통화 (예: KRW, USD) | String |
| status | 상태 (issued/pending/paid) | Enum |
| items | 청구 항목 리스트 (JSON) | JSON |
| notes | 메모 및 결제 조건 | Text |
| public_token | 공개 링크용 토큰 | String (unique) |
| created_at | 생성 시각 | Timestamp |
| updated_at | 수정 시각 | Timestamp |

### InvoiceItem (청구 항목 - JSON 구조)
| 필드 | 설명 | 타입/관계 |
|------|------|----------|
| description | 품목 설명 | String |
| quantity | 수량 | Number |
| unit_price | 단가 | Decimal |
| amount | 금액 (quantity × unit_price) | Decimal |

---

## 🛠️ 기술 스택

### 🎨 프론트엔드 프레임워크

- **Next.js 16.1** (App Router) - React 풀스택 프레임워크
- **TypeScript 5.x** - 타입 안전성 보장
- **React 19.2** - UI 라이브러리

### 🎨 스타일링 & UI

- **TailwindCSS v4** - 유틸리티 CSS 프레임워크
- **shadcn/ui** - 고품질 React 컴포넌트 라이브러리
- **Lucide React** - 아이콘 라이브러리
- **next-themes** - 다크 모드 지원

### 📝 폼 & 검증

- **React Hook Form 7.x** - 폼 상태 관리
- **Zod 4.x** - 스키마 검증 라이브러리

### 🔗 외부 API & 통합

- **@notionhq/client** - Notion API 공식 SDK
- **Notion API v1** - 인보이스 데이터베이스 읽기

### 📄 PDF 생성

- **react-pdf/renderer** 또는 **jsPDF** - 브라우저에서 PDF 생성
- **html2canvas** (선택) - HTML을 캔버스로 변환 후 PDF화

### 🗄️ 데이터베이스 & 인증

- **Supabase** - BaaS (인증, PostgreSQL 데이터베이스)
- **PostgreSQL** - 관계형 데이터베이스

### 🚀 배포 & 호스팅

- **Vercel** - Next.js 최적화 배포 플랫폼

### 📦 패키지 관리

- **npm** - 의존성 관리

---

## 🎯 핵심 기술 아키텍처

### Notion 통합 플로우

```
1. 관리자가 설정 페이지에서 Notion API 키 + DB ID 입력
   ↓
2. Next.js API Route가 Notion SDK로 데이터베이스 쿼리
   ↓
3. Notion 페이지 속성을 Invoice 모델로 변환하여 Supabase에 캐싱
   ↓
4. 대시보드는 Supabase 데이터 표시 (빠른 응답)
   ↓
5. 동기화 버튼 클릭 시 Notion에서 최신 데이터 다시 가져옴
```

### PDF 생성 전략

```
Option A (react-pdf/renderer):
- React 컴포넌트로 PDF 레이아웃 정의
- 서버 사이드에서 PDF 생성 (API Route)
- 장점: 서버에서 생성으로 성능 안정적

Option B (jsPDF + html2canvas):
- 클라이언트에서 HTML을 캔버스로 변환 후 PDF화
- 장점: 구현 간단, 별도 템플릿 불필요
- 단점: 클라이언트 성능 의존
```

### 공유 링크 보안

```
- 각 인보이스마다 고유한 public_token (UUID) 생성
- 공개 URL: /invoice/[public_token]
- 토큰 없이는 접근 불가 (guessable하지 않음)
- 추후 확장: 만료 시간, 액세스 코드 추가 가능
```

---

## ✅ 성공 지표

### 기능 완성도
- [ ] Notion API 연동 성공률 100%
- [ ] PDF 생성 오류율 < 1%
- [ ] 공개 링크 접근 성공률 100%

### 사용자 경험
- [ ] 대시보드 로딩 시간 < 2초
- [ ] PDF 다운로드 시간 < 5초
- [ ] 모바일 반응형 지원 (모든 페이지)

### MVP 달성 목표
- [ ] 관리자가 Notion에서 인보이스 작성 후 10초 내 웹에서 확인 가능
- [ ] 클라이언트가 공유 링크로 즉시 인보이스 조회 및 PDF 다운로드 가능
- [ ] 다크 모드 지원으로 모든 페이지에서 시각적 일관성 유지

---

## 🚀 개발 단계 (참고용)

**Phase 1: 기본 설정 및 Notion 연동**
- Notion API SDK 통합
- 설정 페이지 구현 (F011)
- Notion DB 읽기 테스트

**Phase 2: 인보이스 관리 기능**
- 대시보드 페이지 (F002, F012, F013)
- 인보이스 상세 페이지 (F003)
- Supabase 데이터 모델 구축

**Phase 3: 공유 및 PDF 기능**
- 공유 링크 생성 (F005)
- 공개 인보이스 페이지 (F003)
- PDF 생성 및 다운로드 (F004)

**Phase 4: 인증 및 보안**
- 로그인/회원가입 (F010)
- 보호된 라우트 설정
- API 키 암호화 저장

**Phase 5: 최적화 및 배포**
- 성능 최적화
- 에러 처리 강화
- Vercel 배포 및 도메인 연결

---

## 📋 Notion 데이터베이스 스키마 권장사항

관리자가 Notion에서 생성해야 할 데이터베이스 속성:

| 속성명 | Notion 타입 | 설명 |
|--------|-------------|------|
| Invoice Number | Title | 인보이스 번호 (예: INV-2024-001) |
| Issue Date | Date | 발행일 |
| Client Name | Text | 클라이언트 이름 |
| Client Email | Email | 클라이언트 이메일 |
| Client Address | Text | 클라이언트 주소 |
| Total Amount | Number | 총액 |
| Currency | Select | 통화 (KRW, USD 등) |
| Status | Select | 상태 (Issued, Pending, Paid) |
| Items | Relation 또는 Text | 청구 항목 (JSON 형식으로 저장) |
| Notes | Text | 결제 조건 및 메모 |

---

## 🔒 보안 고려사항 (MVP)

- Notion API 키는 환경 변수 또는 Supabase에 암호화 저장
- 공개 인보이스 페이지는 public_token으로만 접근 가능
- 관리자 페이지는 인증 필수 (미들웨어로 보호)
- API Route에서 사용자 권한 검증

---

## 📚 개발자 참고사항

### Notion API 사용 예시

```typescript
import { Client } from '@notionhq/client';

const notion = new Client({ auth: process.env.NOTION_API_KEY });

// 데이터베이스 쿼리
const response = await notion.databases.query({
  database_id: databaseId,
  sorts: [{ property: 'Issue Date', direction: 'descending' }],
});
```

### PDF 생성 예시 (react-pdf/renderer)

```typescript
import { Document, Page, Text, View, PDFDownloadLink } from '@react-pdf/renderer';

const InvoicePDF = ({ invoice }) => (
  <Document>
    <Page size="A4">
      <View><Text>Invoice #{invoice.invoice_number}</Text></View>
      {/* ... */}
    </Page>
  </Document>
);
```

### 공유 링크 생성

```typescript
import { randomUUID } from 'crypto';

const publicToken = randomUUID();
const shareableUrl = `${process.env.NEXT_PUBLIC_BASE_URL}/invoice/${publicToken}`;
```

---

**문서 버전**: 1.0
**최종 수정일**: 2025-12-25
**작성자**: PRD 생성 시스템 (Claude Code)

---

## 정합성 검증 완료 ✅

### 1단계: 기능 명세 → 페이지 연결 검증
- ✅ F001 → 설정 페이지, 대시보드 페이지
- ✅ F002 → 대시보드 페이지
- ✅ F003 → 인보이스 상세 페이지, 공개 인보이스 페이지
- ✅ F004 → 인보이스 상세 페이지, 공개 인보이스 페이지
- ✅ F005 → 인보이스 상세 페이지
- ✅ F010 → 로그인 페이지
- ✅ F011 → 설정 페이지
- ✅ F012 → 대시보드 페이지, 설정 페이지
- ✅ F013 → 대시보드 페이지, 인보이스 상세 페이지

### 2단계: 메뉴 구조 → 페이지 연결 검증
- ✅ 홈 → 홈 페이지
- ✅ 로그인 → 로그인 페이지
- ✅ 대시보드 → 대시보드 페이지
- ✅ 인보이스 상세 → 인보이스 상세 페이지
- ✅ 설정 → 설정 페이지
- ✅ 인보이스 조회 → 공개 인보이스 페이지

### 3단계: 페이지별 상세 기능 → 역참조 검증
- ✅ 모든 페이지의 구현 기능 ID가 기능 명세에 정의됨
- ✅ 모든 페이지가 메뉴 구조에서 접근 가능

### 4단계: 누락 및 고아 항목 검증
- ✅ 기능 명세의 모든 기능이 페이지에서 구현됨
- ✅ 페이지의 모든 기능이 기능 명세에 정의됨
- ✅ 메뉴의 모든 항목에 대응하는 페이지 존재

**정합성 검증 결과: 통과 ✅**
